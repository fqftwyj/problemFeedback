<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>新的定时任务系统表</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="${request.contextPath}/static/layuiadmin/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="${request.contextPath}/static/layuiadmin/style/admin.css" media="all">
  <link rel="stylesheet" href="${request.contextPath}/static/ywUi/css/finace/finace.css" media="all">
</head>
<body>
<div class="layui-fluid  reimburse-background-color" id="reimburseDivForm">
<div class="layui-form " lay-filter="layuiadmin-form-admin" id="layuiadmin-form-admin" style="padding: 20px 30px 0 0;">
    <div class="layui-form-item">
      <div class="layui-col-md11">
        <div class="layui-inline">
          <label class="layui-form-label">  <span class="layui-form-label-span-must" >*</span>科室：</label>
          <div class="layui-input-block" style="display: block;">
            <select name='officeCode'>
              <option value="" <#if result.officeCode=="">selected</#if>>请输入</option>
              <#list officeList as obj>
              <option value="${obj.officeCode}" <#if obj.officeCode==result.officeCode>selected</#if>>${obj.officeName}</option>
            </#list>
            </select>
          </div>
        </div>
        <div class="layui-inline">
          <label class="layui-form-label">  <span class="layui-form-label-span-must" >*</span>出差人：</label>
          <div class="layui-input-block-special" >
            <input type="text" name="reimburseMembers" placeholder="请输入" autocomplete="off"
                   class="layui-input" value="${result.reimburseMembers}" lay-verify="required">
          </div>
          <div class="reimburse-card-body-title-text reimburse-card-body-title-text-i-float">
            <i class="layui-icon layui-icon-about title-text-icon  title-text-icon-second-separator"
               id="travelPeopleInfo"></i>
          </div>
        </div>
      </div>
      <div class="layui-col-md11">
        <div class="layui-inline layui-col-md9">
          <label class="layui-form-label">  <span class="layui-form-label-span-must" >*</span>出差事由：</label>
          <div class="layui-input-block">
            <textarea placeholder="请输入内容"  name="reimburseReason" class="layui-textarea" lay-verify="required">${result.reimburseReason}</textarea>
          </div>

        </div>
      </div>
  <div class="layui-col-md11">
    <div class="layui-inline">
      <label class="layui-form-label">  <span class="layui-form-label-span-must" >*</span>经费来源：</label>
      <div class="layui-input-block" style="display: block;">
        <select name='foundSource' lay-filter="foundSourceSel">
          <option value="" <#if result.foundSource=="">selected</#if>>请输入</option>
        <#list foundSourceEnum as obj>
        <option value="${obj}"  <#if obj==result.foundSource>selected</#if>>${obj.desc}</option>
       </#list>
       </select>
  </div>
</div>
<div class="layui-inline" id="specialNameId">
  <label class="layui-form-label">  <span class="layui-form-label-span-must" >*</span>专项名称：</label>
  <div class="layui-input-block-special" >
    <input type="text" name="specialName" placeholder="请输入" autocomplete="off"
           class="layui-input" value="${result.specialName}" lay-verify="required">
  </div>
</div>
</div>
    <input type="hidden" name="reimburseType" value="${result.reimburseType}" >
    <input type="hidden" name="staffCode" value="${result.staffCode}" >
    </div>
    <div class="layui-card-body  layui-card-body-scroll">
      <div class="reimburse-card-body-title">
        <div class="reimburse-card-body-title-text">
          车船费
          <i class="layui-icon layui-icon-add-1 title-text-icon title-text-icon-first carboatfeeAdd" ></i>
          <i class="layui-icon layui-icon-about title-text-icon title-text-icon-second" id="carboatInfo"></i>

        </div>
        <div class="separator-line-css carboatfeeMotherDiv" style="display:none"  id="carboatfeeMotherHideDiv">
          <div class="layui-col-md11 mbottom">
            <div class="layui-inline">
              <label class="layui-form-label">出发时间：</label>
              <div class="layui-input-block">
                <input type="text" name="departureTime"  placeholder="请输入" autocomplete="off"
                       class="layui-input datetime">
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">出发地点：</label>
              <div class="layui-input-block">
                <input type="text" name="departurePlace" placeholder="请输入" autocomplete="off"
                       class="layui-input">
              </div>
            </div>
          </div>
          <div class="layui-col-md11 mbottom">
            <div class="layui-inline">
              <label class="layui-form-label">到达时间：</label>
              <div class="layui-input-block">
                <input type="text" name="arrivalTime"  placeholder="请输入" autocomplete="off"
                       class="layui-input datetime">
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">到达地点：</label>
              <div class="layui-input-block">
                <input type="text" name="arrivalPlace" placeholder="请输入" autocomplete="off"
                       class="layui-input">
              </div>
            </div>
          </div>
          <div class="layui-col-md11 mbottom">
            <div class="layui-inline layui-form">
              <label class="layui-form-label">车船类别：</label>
              <div class="layui-input-block" style="width: 182px;">
                <select name='carboatType' >
                  <option value="">请输入</option>
                  <option value="汽车">汽车</option>
                  <option value="火车">火车</option>
                  <option value="飞机">飞机</option>
                  <option value="轮船">轮船</option>
                </select>
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">单据张数：</label>
              <div class="layui-input-block">
                <input type="text" name="docNumber" placeholder="请输入" autocomplete="off"
                       class="layui-input" lay-verify="int">
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">车船费：</label>
              <div class="layui-input-block">
                <input type="text" name="carboatfee" placeholder="请输入" autocomplete="off"
                       class="layui-input" lay-verify="money">
              </div>
            </div>

            <div class="layui-inline layui-form">
              <div class="reimburse-del-div" >
                <div class="reimburse-card-body-title-text reimburse-card-body-title-text-i-float">
                  <i class="layui-icon layui-icon-close title-text-icon carboatfeeDel" ></i>

                </div>
              </div>
            </div>

          </div>
        </div>
        <#list carboatfeesList as obj>
        <div class="separator-line-css carboatfeeMotherDiv"  id="carboatfeeMotherDiv">
          <div class="layui-col-md11 mbottom">
            <div class="layui-inline">
              <label class="layui-form-label">出发时间：</label>
              <div class="layui-input-block">
                <input type="text" name="departureTime" placeholder="yyyy-MM-dd" autocomplete="off"
                       class="layui-input datetime" value="${obj.departureTime!}">
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">出发地点：</label>
              <div class="layui-input-block">
                <input type="text" name="departurePlace"  value="${obj.departurePlace!}" placeholder="请输入" autocomplete="off"
                       class="layui-input">
              </div>
            </div>
          </div>
          <div class="layui-col-md11 mbottom">
            <div class="layui-inline">
              <label class="layui-form-label">到达时间：</label>
              <div class="layui-input-block">
                <input type="text" name="arrivalTime" value="${obj.arrivalTime!}"  placeholder="yyyy-MM-dd" autocomplete="off"
                       class="layui-input datetime">
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">到达地点：</label>
              <div class="layui-input-block">
                <input type="text" name="arrivalPlace" value="${obj.arrivalPlace!}" placeholder="请输入" autocomplete="off"
                       class="layui-input">
              </div>
            </div>
          </div>
          <div class="layui-col-md11 mbottom">
            <div class="layui-inline layui-form">
              <label class="layui-form-label">车船类别：</label>
              <div class="layui-input-block" style="width: 182px;">
                <select name='carboatType' >
                  <option value=""    <#if !obj.carboatType??||(obj.carboatType?? && obj.carboatType=='')>selected</#if>>请输入</option>
                  <option value="汽车" <#if obj.carboatType?? && obj.carboatType=='汽车'>selected</#if>>汽车</option>
                  <option value="火车" <#if obj.carboatType?? && obj.carboatType=='火车'>selected</#if>>火车</option>
                  <option value="飞机" <#if obj.carboatType?? && obj.carboatType=='飞机'>selected</#if>>飞机</option>
                  <option value="轮船" <#if obj.carboatType?? && obj.carboatType=='轮船'>selected</#if>>轮船</option>
                </select>
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">单据张数：</label>
              <div class="layui-input-block">
                <input type="text" name="docNumber" placeholder="请输入" autocomplete="off"
                       class="layui-input" value="${obj.docNumber!}" lay-verify="int">
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">车船费：</label>
              <div class="layui-input-block">
                <input type="text" name="carboatfee" placeholder="请输入" autocomplete="off"
                       class="layui-input" value="${obj.carboatfee!}" lay-verify="money">
              </div>
            </div>

            <div class="layui-inline layui-form">
              <div class="reimburse-del-div" >
                <div class="reimburse-card-body-title-text reimburse-card-body-title-text-i-float">
                  <i class="layui-icon layui-icon-close title-text-icon carboatfeeDel" ></i>

                </div>
              </div>
            </div>

          </div>
        </div>
      </#list>
      </div>
      <div class="reimburse-card-body-title">
        <div class="reimburse-card-body-title-text">
          出差补贴
          <i class="layui-icon layui-icon-add-1 title-text-icon title-text-icon-first travelStandardAdd"></i>
          <i class="layui-icon layui-icon-about title-text-icon title-text-icon-second"
             id="travelStandardInfo"></i>
        </div>
        <div class="travelStandardMotherDiv" style="display: none;" id="travelStandardMotherHideDiv">
          <div class="layui-col-md11 mbottom" >
            <div class="layui-inline">
              <label class="layui-form-label">天数：</label>
              <div class="layui-input-block">
                <input type="text" name="days" placeholder="请输入" autocomplete="off"
                       class="layui-input days" lay-verify="int" >
              </div>
            </div>
            <div class="layui-inline layui-form">
              <label class="layui-form-label" >标准：</label>
              <div class="layui-input-block" style="width: 182px;">
                <select name='travelStandard'  lay-filter="travelStandard">
                  <option value="">请输入</option>
                  <option value="25">25</option>
                  <option value="55">55</option>
                  <option value="42.5">42.5</option>
                </select>
              </div>

            </div>
            <div class="layui-inline">
              <label class="layui-form-label">金额：</label>
              <div class="layui-input-block">
                <input type="text" name="travelmoney" readonly="readonly" placeholder="请输入" autocomplete="off"
                       class="layui-input">
              </div>
            </div>
            <div class="layui-inline layui-form">
              <div class="reimburse-del-div" >
                <div class="reimburse-card-body-title-text reimburse-card-body-title-text-i-float">
                  <i class="layui-icon layui-icon-close title-text-icon travelStandardDel"  ></i>

                </div>
              </div>
            </div>
          </div>
        </div>
        <#list travelAllowanceList as obj>
        <div class="travelStandardMotherDiv"  id="travelStandardMotherDiv">
          <div class="layui-col-md11 mbottom" >
            <div class="layui-inline">
              <label class="layui-form-label">天数：</label>
              <div class="layui-input-block">
                <input type="text" name="days" lay-filter="days" placeholder="请输入整数" autocomplete="off"
                       class="layui-input days" value="${obj.days!}" lay-verify="int" >
              </div>
            </div>
            <div class="layui-inline layui-form">
              <label class="layui-form-label">标准：</label>
              <div class="layui-input-block" style="width: 182px;">
                <select name='travelStandard' lay-filter="travelStandard">

                  <option value=""     <#if !obj.travelStandard??||(obj.travelStandard?? && obj.travelStandard=='')>selected</#if>>请输入</option>
                  <option value="25"  <#if obj.travelStandard?? && obj.travelStandard=='25'>selected</#if>>25</option>
                  <option value="55"  <#if obj.travelStandard?? && obj.travelStandard=='55'>selected</#if>>55</option>
                  <option value="42.5" <#if obj.travelStandard?? && obj.travelStandard=='42.5'>selected</#if>>42.5</option>
                </select>
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">金额：</label>
              <div class="layui-input-block">
                <input type="text" name="travelmoney" readonly="readonly" placeholder="请输入" autocomplete="off"
                       class="layui-input" value="${obj.travelmoney!}">
              </div>
            </div>
            <div class="layui-inline layui-form">
              <div class="reimburse-del-div" >
                <div class="reimburse-card-body-title-text reimburse-card-body-title-text-i-float">
                  <i class="layui-icon layui-icon-close title-text-icon travelStandardDel"  ></i>

                </div>
              </div>
            </div>
          </div>
        </div>
      </#list>
      </div>
      <div class="reimburse-card-body-title">
        <div class="reimburse-card-body-title-text">
          其它费用
          <i class="layui-icon layui-icon-add-1 title-text-icon title-text-icon-first otherfeeAdd" ></i>
          <i class="layui-icon layui-icon-about title-text-icon title-text-icon-second" id='otherfeeInfo'></i>
        </div>
        <div class="otherfeeMotherDiv" style="display:none" id="otherfeeMotherHideDiv">
          <div class="layui-col-md11 mbottom" >
            <div class="layui-inline">
              <label class="layui-form-label">项目：</label>
              <div class="layui-input-block">
                <input type="text" name="itemname" placeholder="请输入" autocomplete="off"
                       class="layui-input">
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">单据张数：</label>
              <div class="layui-input-block">
                <input type="text" name="otherdocnumber" placeholder="请输入" autocomplete="off"
                       class="layui-input" lay-verify="int">
              </div>
            </div>
            <div class="layui-inline layui-form">
              <label class="layui-form-label">金额：</label>
              <div class="layui-input-block">
                <input type="text" name="otherfeemoney" placeholder="请输入" autocomplete="off"
                       class="layui-input" lay-verify="money">
              </div>
            </div>
            <div class="layui-inline layui-form">
              <div class="reimburse-del-div" >
                <div class="reimburse-card-body-title-text reimburse-card-body-title-text-i-float">
                  <i class="layui-icon layui-icon-close title-text-icon otherfeeDel" ></i>

                </div>
              </div>
            </div>
          </div>
        </div>
        <#list otherFeeList as obj>
        <div class="otherfeeMotherDiv"  id="otherfeeMotherDiv">
          <div class="layui-col-md11 mbottom" >
            <div class="layui-inline">
              <label class="layui-form-label">项目：</label>
              <div class="layui-input-block">
                <input type="text" name="itemname" placeholder="请输入" autocomplete="off"
                       class="layui-input" value="${obj.itemname!}">
              </div>
            </div>
            <div class="layui-inline">
              <label class="layui-form-label">单据张数：</label>
              <div class="layui-input-block">
                <input type="text" name="otherdocnumber" placeholder="请输入" autocomplete="off"
                       class="layui-input"  value="${obj.otherdocnumber!}" lay-verify="int">
              </div>
            </div>
            <div class="layui-inline layui-form">
              <label class="layui-form-label">金额：</label>
              <div class="layui-input-block">
                <input type="text" name="otherfeemoney" placeholder="请输入" autocomplete="off"
                       class="layui-input" value="${obj.otherfeemoney!}" lay-verify="money">
              </div>
            </div>
            <div class="layui-inline layui-form">
              <div class="reimburse-del-div" >
                <div class="reimburse-card-body-title-text reimburse-card-body-title-text-i-float">
                  <i class="layui-icon layui-icon-close title-text-icon otherfeeDel" ></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </#list>
      </div>
      <div class="reimburse-card-body-title">
        <div class="reimburse-card-body-title-text">合计 <i class="layui-icon  layui-icon-rmb title-text-icon title-text-icon-first totalCaculate" ></i></div>


        <div class="layui-col-md11 mbottom">
          <div class="layui-inline layui-inline-total">
            <label class="layui-form-label layui-form-label-width">车船费+出差补贴费：</label>
            <div class="layui-input-block layui-input-block-left">
              <input type="text" name="totalCarBoatTravel" id="totalCarBoatTravel" placeholder="请输入"  readonly="readonly" autocomplete="off"
                     class="layui-input" value="${totalCarBoatTravel}">
            </div>
          </div>
          <div class="layui-inline">
            <label class="layui-form-label">其它费用：</label>
            <div class="layui-input-block">
              <input type="text" name="totalotherFee" id="totalotherFee" placeholder="请输入" autocomplete="off" readonly="readonly"
                     class="layui-input" value="${totalotherFee}">
            </div>
          </div>
        </div>
      </div>
     <input type="hidden" name="reimburseDate" value="${result.reimburseDate}"/>
      <div class="layui-card-body-scroll">
  <div class="layui-col-md11 mbottom">
    <!--    <button type="button" class="layui-btn" id="test1">
            <i class="layui-icon">&#xe67c;</i>附件上传
        </button>-->
    <input type="hidden"  name="module" id="module" value="${userName}"/>
    <input type="hidden"  name="id"  value="${result.id}"/>
    <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
      <div id="uploadImg" class="layui-upload">
        <button type="button" class="layui-btn" id="uploadEdit" lay-verify="validateAttach">
          <i class="layui-icon">&#xe67c;</i>上传报销附件<span style="color: red;font-size: 20px;">*</span>
        </button>
       <!-- <button type="button" class="layui-btn" id="uploadEdit" lay-verify="validateAttach">
          <i class="layui-icon">&#xe67c;</i>上传报销附件<span style="color: red;font-size: 20px;">*</span>
        </button>-->
        <div class="layui-upload-list">
          <table class="layui-table" style="text-align: center;">
            <thead>
            <tr>
              <th style="text-align: center;">文件名称</th>
              <th style="text-align: center;">大小</th>
              <th style="text-align: center;">状态</th>
              <th style="text-align: center;">操作</th>
            </tr>
            </thead>
            <tbody id="imgList">
            <#list uploadList as up>
            <tr id="upload-"+${up_index+1}>
              <td><a  data-name="${up.uploadName}" data-path="${up.uploadPath}" class="downloadA" data-module="${userName}" onclick="fqdownload('/upload/fileDownload?',this)">${up.uploadName}</a></td>
              <td>${up.uploadSize}</td>
              <td>已上传</td>
              <td><button class="layui-btn layui-btn-danger demo-delete-edit"   txt="${up.uploadPath}" txtNM="${up.uploadName}">删除</button></td>
            </tr>
            </#list>
            </tbody>
          </table>
        </div>
        <button type="button" class="layui-btn" id="startUpload22">开始上传</button>
          <div style="color: #dc1010;margin:10px 0;">温馨提示: 每次可上传多个文件,每个文件大小不超过100M,文件内容包括签字完整的外出培训审批表、培训（进修）通知单、培训费/进修费发票（报销人背面签字）、
            住宿费发票（报销人背面签字）、交通费发票（报销人背面签字）、报销人银行卡复印件。
          </div>
      </div>
      <input type="hidden" name="uploadPath" id="imgInput"     value="${result.uploadPath}">
      <input type="hidden" name="uploadName" id="imgInputName"   value="${result.uploadName}">
      <input type="hidden" name="delFilePath" id="delFilePath"   value="">
    </blockquote>

  </div>
</div>


    <div class="layui-form-item layui-hide">
      <input type="button" lay-submit lay-filter="LAY-reimburse-edit-submit" id="LAY-reimburse-edit-submit" value="确认">
    </div>
</div>
</div>
<script src="${request.contextPath}/static/layuiadmin/layui/layui.js"></script>
<!--引入jquery,在layui外部调用jquery-->
<script src="${request.contextPath}/static/ywUi/js/lib/jquery-2.1.0.js"></script>

<script>

  layui.config({
    base: '${request.contextPath}/static/layuiadmin/' //静态资源所在路径
  }).extend({
    index: 'lib/index', //主入口模块
    verfy: '../../ywUi/js/commons/verfy',
    reimburseAdd: '../../ywUi/js/finace/reimburseAdd'
  }).use(['index', 'reimburseAdd', 'form', 'verfy','upload'], function () {
    var $ = layui.$,
            form = layui.form,
            table = layui.table,
            upload=layui.upload;

    //自定义验证规则-附件不能为空

    form.verify({
      validateAttach: function (value) {
        var len = $("#imgList").find("tr").length;
        if (len==0) {
          return "请先上传附件";
        }else{
          var imgInput=$("#imgInput").val();
          if(imgInput==""){
            return "请上传列表中待上传的文件";
          }
        }
      }
    });

    //组装删除后的文件路径或文件名字字符串
    function afterDelStr(curName,names,nameArr,curPath,paths,pathArr){
      var targetNameArr=[];
      var targetPathArr=[];
      for(j = 0; j < pathArr.length; j++) {
        if(pathArr[j]!=curPath){
          targetPathArr.push(pathArr[j]);
          targetNameArr.push(nameArr[j]);
        }
      }

      return targetPathArr.join(",")+";"+targetNameArr.join(",");
    }
    var funs={
      delEditFun:function(){
        $(".demo-delete-edit").off("click").on("click",function (data){
          //重组文件路径相关
          var curPath=$(this).attr("txt");
          var paths='${result.uploadPath}';
          var pathArr=paths.split(",");

          //重组文件名称相关
          var curName=$(this).attr("txtNM");
          var names='${result.uploadName}';
          var nameArr=names.split(",");
          var lastPathNameArr=afterDelStr(curName,names,nameArr,curPath,paths,pathArr).split(";");
          var lastPathStr="";
          var lastNameStr="";
          if(lastPathNameArr.length>1){
            lastPathStr=lastPathNameArr[0];
            lastNameStr=lastPathNameArr[1];
          }

          var delFilePath=$("#delFilePath").val();
          if(delFilePath){
            delFilePath+=","+curPath;
          }else{
            delFilePath=curPath;

          }
          $("#delFilePath").val(delFilePath);
          $("#imgInput").val(lastPathStr);
          $("#imgInputName").val(lastNameStr);
          //删除文件的请求
          $(this).parent().parent().remove();


        });
    }};
    funs.delEditFun();


    //多文件列表示例
    var demoListView = $('#imgList');
    var totalArray = new Array();

    var uploadListIns =upload.render({
      elem: '#uploadEdit'
      ,url: '/upload/fileUpload'
      ,accept: 'file' //允许上传的文件类型
      , size: 1024*100        // 最大允许上传的文件大小  单位 KB
      , auto: false //选择文件后不自动上传
      , bindAction: '#startUpload22' //指向一个按钮触发上传
      , multiple: true   // 开启多文件上传
      ,data: {
        module: function(){
          return $('#module').val();
        }
      }
      ,before: function(obj){ //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
       /* layer.load(); //上传loading*/

      }
   /*   , number: 6    //  同时上传文件的最大个数*/
      , choose: function (obj) {
        var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
        var arr = Object.keys(files);
        totalArray = totalArray.concat(arr);
        // 检查上传文件的个数
      /*  if (totalArray.length <= 6) {*/
          //读取本地文件
          obj.preview(function (index, file, result) {
            var tr = $(['<tr id="upload-' + index + '">'
              , '<td>' + file.name + '</td>'
              , '<td>' + (file.size / 1014).toFixed(0) + 'kb</td>'
              , '<td>等待上传</td>'
              , '<td>'
              , '<button class="layui-btn demo-reload layui-hide">重传</button>'
              , '<button class="layui-btn layui-btn-danger demo-delete">删除</button>'
              , '</td>'
              , '</tr>'].join(''));
            //单个重传
            tr.find('.demo-reload').on('click', function () {
              obj.upload(index, file);
            });

            //删除
            tr.find('.demo-delete').on('click', function () {
              delete files[index]; //删除对应的文件
              tr.remove();
              uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
            });

            demoListView.append(tr);
          });
       /* } else {
          // 超出上传最大文件
          layer.msg("上传文件最大不超过6个")
        }*/

      }
      , done: function (res, index, upload) {
       /* layer.closeAll('loading'); //关闭loading*/
        console.log("res", res);
        if (res.code == 0) { //上传成功
          // 上传成功后将图片路径拼接到input中，多个路径用","分割
          var dat=res.data.split(";");
          var inputVal =  $("#imgInput").val();
          var imgInputNameVal =$("#imgInputName").val() ;
          var valDataPath = "";
          var valData1Name = "";
          if (inputVal) {
            valDataPath = inputVal + "," + dat[0];
            valData1Name = imgInputNameVal + "," + dat[1];
          } else {
            valDataPath =  dat[0];
            valData1Name = dat[1];
          }
          $("#imgInput").val(valDataPath);
          $("#imgInputName").val(valData1Name);

          console.log( $("#imgInput").val()+"=="+ $("#imgInputName").val());
          var tr = demoListView.find('tr#upload-' + index)
                  , tds = tr.children();
          var module='${userName}';
          tds.eq(0).html('<a  data-name=\"'+dat[1]+'\" data-path=\"'+dat[0]+'\" class=\"downloadA\" data-module=\"'+module+'\" onclick=\"fqdownload(\'/upload/fileDownload?\',this)\">'+dat[1]+'</a>');
          tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
          tds.eq(3).html('<button class=\"layui-btn layui-btn-danger demo-delete-edit\"   txt=\"'+dat[0]+'\" txtNM=\"'+dat[1]+'\">删除</button>'); //清空操作
          funs.delEditFun();
          return delete this.files[index]; //删除文件队列已经上传成功的文件

        }
        this.error(index, upload);
      }
      , error: function (index, upload) {
        var tr = demoListView.find('tr#upload-' + index)
                , tds = tr.children();
        tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
        tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
      }
    });
  });


//这里在这个页面再引入一个jquery.jsji
  function fqdownload(url,ele){
    var $this=$(ele);
    var name=$this.data("name");
    var path=$this.data("path");
    var module=$this.data("module");
    window.location=url+"fileName="+encodeURIComponent(name)+"&filePath="+encodeURIComponent(path)+"&module="+module;
  }

</script>
</body>
</html>